<template name="conversation">
    {{! template d'affichage d'une conversation, il est le meme pour la version mobile et desktop
    il s'appelle avec :
    conversation: Object // la conversation telle qu'elle existe dans le document user}}
    <div class="flex" style=" height: 100% !important; flex-direction: column">
        <div class="row no-margin small-padding "
             style="background-color: rgba(0,0,0, 0.2); border-radius: 3px 3px 0 0 !important;">
            <div class="col s10 relative valign-wrapper" style="padding : {{#if isPhone}}15px 0 0 0 {{else}}0{{/if}}">
                {{#if gt conversation.otherSpeakers.length 1}}
                    <span class="absolute valign-wrapper   dark-grey {{#if pulse}} pulse{{/if}}" style="
                            z-index: 101 !important;
                            bottom :-4px;
                            left : 2px ;
                            border-radius: 50%;
                            width: 20px !important;
                            height: 20px !important;
                            text-align: center !important;
                            background-color: #0e0e0e;
                            -webkit-box-shadow: 2px 2px 15px -2px rgba(0,0,0,0.68);
                            -moz-box-shadow: 2px 2px 15px -2px rgba(0,0,0,0.68);
                            box-shadow: 2px 2px 15px -2px rgba(0,0,0,0.68);
                            cursor: pointer;">
                        <span class="light-grey-police center-align relative"
                              style="font-size: 0.8em !important;">
                            <b>{{conversation.otherSpeakers.length}}</b>
                        </span>
                    </span>
                {{/if}}
                <img src="{{conversation.otherSpeakers.[0].imgUrl}}"
                     alt="" class="responsive-img circle
                                    {{#if conversation.otherSpeakers.[0].isProject}}
                                    orange{{else}}
                                    green{{/if}}-border" style="width: 46px !important; height: 46px !important;">

                {{#each otherSpeaker in conversation.otherSpeakers}}
                    <a class="light-grey-police small-padding
                    {{#if otherSpeaker.isProject}}hover-orange{{else}}hover-green{{/if}}"
                       href="{{#if otherSpeaker.isProject}}
                           {{pathFor route='projectMainPage' _id=otherSpeaker.speaker_id}}
                       {{else}}
                           {{pathFor route='userMainPage' _id=otherSpeaker.speaker_id}}
                       {{/if}}">
                        <b>{{otherSpeaker.name}}</b>
                    </a>
                    {{#unless indexEq @index conversation.otherSpeakers.length }}
                        , {{/unless}}

                {{/each}}
            </div>
            <div class="col s2 relative no-padding">
                <a href="" class="relative" style="left: 25px !important;" closeConversation>
                    <i class="material-icons light-grey-police">clear</i>
                </a>
            </div>
        </div>
        <div class="row no-margin light-grey-police flex-auto " style="padding: 0 5px; overflow-y: hidden">
            <div class="scrollbar " id="chatMessages{{conversation.conversation_id}}"
                 style="height: 275px; margin-right: 5px">
                <div class="row no-margin center-align ">
                    <a href="" class="waves-effect waves-light center-align btn-flat blue-grey-text" moreMessages>Plus
                        de messages</a>
                </div>
                {{#each encryptedMessage in messages}}
                    {{#if convKey}}
                        {{>message
                                encryptedMessage = encryptedMessage
                                convKey = convKey
                                conversation = conversation
                                index = @index
                        }}
                    {{/if}}
                {{/each}}
                <div class="" style="height: 50px !important;"></div>
            </div>

        </div>
        <div class="row no-margin " style=" border-radius: 0 0 3px 3px !important; height: 100px">
            <form chat>
                <div class="relative borer-radius shadow"
                     style="
         background-color: rgba(255,255,255,0.05);
         min-height: 80px; padding: 5px 0px 5px 5px !important; margin: 10px">
                    <div class="text editable no-padding no-margin puce-list formattedText chatEditor small-info light-grey-police scrollbar"
                         style="text-align: justify; height : 70px!important; "
                         id="chat-content{{conversation.conversation_id}}">
                    </div>
                    <a class="btn-floating waves-effect waves-light relative tooltipped dark-grey  absolute shadow hover-orange blue-grey-border"
                       data-position="bottom" data-delay="350"
                       style="top : -25px !important; right : {{#unless
                               isPhone}}-30px{{else}}10px{{/unless}} !important;"
                       data-tooltip="envoyer" sendChat>
                        <i class="material-icons  blue-grey-text relative " style="top : -2px">send</i>
                    </a>
                </div>
            </form>
        </div>
    </div>

</template>