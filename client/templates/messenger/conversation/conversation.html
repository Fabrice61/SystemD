<template name="conversation">
    {{! template d'affichage d'une conversation, il est le meme pour la version mobile et desktop
    il s'appelle avec :
    conversation: Object // la conversation telle qu'elle existe dans le document user}}
    <div id="conv-{{conversation.conversation_id}}"></div>
    <div class="flex" style=" height: 100% !important; flex-direction: column">
        <div class="row no-margin small-padding shadow"
             style="background-color: rgba(0,0,0, 0.2); border-radius: 3px 3px 0 0 !important;">
            <div class="col s10 relative valign-wrapper no-padding" >
                {{#if gt conversation.otherSpeakers.length 1}}
                    <span class="absolute valign-wrapper   dark-grey {{#if pulse}} pulse{{/if}}" style="
                            z-index: 101 !important;
                            bottom :-4px;
                            left : 2px ;
                            border-radius: 50%;
                            width: 20px !important;
                            height: 20px !important;
                            text-align: center !important;
                            background-color: #0e0e0e;
                            -webkit-box-shadow: 2px 2px 15px -2px rgba(0,0,0,0.68);
                            -moz-box-shadow: 2px 2px 15px -2px rgba(0,0,0,0.68);
                            box-shadow: 2px 2px 15px -2px rgba(0,0,0,0.68);
                            cursor: pointer;">
                        <span class="light-grey-police center-align relative"
                              style="font-size: 0.8em !important;">
                            <b>{{conversation.otherSpeakers.length}}</b>
                        </span>
                    </span>
                {{/if}}
                <img src="{{conversation.otherSpeakers.[0].imgUrl}}"
                     alt="" class="responsive-img circle
                                    {{#if conversation.otherSpeakers.[0].isProject}}
                                    orange{{else}}
                                    green{{/if}}-border" style="width: 46px !important; height: 46px !important;">
                <span class="absolute valign-wrapper circle  notif-presence-conv {{#if isPresent}}green {{else}} light-grey-border grey darken-2{{/if}}">
                    </span>

                {{#each otherSpeaker in conversation.otherSpeakers}}
                    <a class="light-grey-police small-padding
                    {{#if otherSpeaker.isProject}}hover-orange{{else}}hover-green{{/if}}"
                       href="{{#if otherSpeaker.isProject}}
                           {{pathFor route='projectMainPage' _id=otherSpeaker.speaker_id}}
                       {{else}}
                           {{pathFor route='userMainPage' _id=otherSpeaker.speaker_id}}
                       {{/if}}">
                        <b>{{otherSpeaker.name}}</b>
                    </a>
                    {{#unless indexEq @index conversation.otherSpeakers.length }}
                        , {{/unless}}

                {{/each}}
            </div>
            <div class="col s2 relative no-padding">
                <a href="" class="relative" style="{{#if isPhone}}left: -5px ; top : 15px !important;{{else}}left:25px !important;{{/if}} " closeConversation>
                    <i class="material-icons light-grey-police">clear</i>
                </a>
            </div>
        </div>
        <div class="row no-margin light-grey-police flex-auto " style="padding: 0 5px; overflow-y: hidden">
            <div class="scrollbar " id="chatMessages{{conversation.conversation_id}}"
                 style="{{#if isPhone}}height: {{phoneHeight}}px;{{else}}height: 275px{{/if}}; margin-right: 5px">
                <div class="row center-align " style="margin: 20px 0 !important;">
                    {{#unless noMoreMessageToFind}}
                    <a href="" class="waves-effect waves-light center-align btn-flat blue-grey-text" moreMessages>Plus
                        de messages</a>
                        {{else}}
                        <div class="" style="height: 36px !important;">
                            {{#if gt messages.length 6}}
                                    <span class="small-info blue-grey-text">La conversation à débuté le {{localeDate messages.[0].sendAt}}</span>
                            {{/if}}
                        </div>
                    {{/unless}}
                </div>
                {{#each encryptedMessage in messages}}
                    {{#if convKey}}
                        {{>message
                                encryptedMessage = encryptedMessage
                                convKey = convKey
                                conversation = conversation
                                index = @index
                        }}
                    {{/if}}
                {{/each}}
                <div class="" style="height: 50px !important;"></div>
            </div>
        </div>
        <link rel="stylesheet" href="/css/medium-editor.css">
        <div class="row no-margin " style=" border-radius: 0 0 3px 3px !important; height: 100px">
            <form chat>
                <div class="relative borer-radius shadow blue-grey darken-4"
                     style="
         min-height: 80px; padding: 5px 0px 5px 5px !important; margin: 5px 10px 10px 10px">
                    <div class="text editable no-padding no-margin puce-list formattedText chatEditor small-info light-grey-police scrollbar"
                         style="text-align: justify; height : 70px!important; "
                         id="chat-content{{conversation.conversation_id}}">
                    </div>
                    <a class="btn-floating waves-effect waves-light relative tooltipped dark-grey  absolute shadow hover-orange blue-grey-border"
                       data-position="left" data-delay="350"
                       style="top : -25px !important; {{#unless isPhone}}right : -30px  !important;{{else}}right : -5px !important; height: 50px !important; width: 50px !important;{{/unless}}"
                       data-tooltip="envoyer" sendChat>
                        <i class="material-icons  blue-grey-text relative " style="{{#if isPhone}} left: -15px !important;top : 1px; {{else}}top : -2px; {{/if}}">send</i>
                    </a>
                </div>
            </form>
        </div>
    </div>

</template>